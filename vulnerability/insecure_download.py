import http.server
import socketserver
import urllib.parse

class MyHandler(http.server.SimpleHTTPRequestHandler):
    def do_GET(self):
        if self.path.startswith("/download"):
            query = urllib.parse.urlparse(self.path).query
            params = urllib.parse.parse_qs(query)
            filename = params.get("file", [""])[0]

            try:
                with open(filename, "rb") as f:
                    self.send_response(200)
                    self.end_headers()
                    self.wfile.write(f.read())
            except:
                self.send_error(404, "File non trovato")
        else:
            super().do_GET()

PORT = 8000
handler = MyHandler
with socketserver.TCPServer(("", PORT), handler) as httpd:
    print(f"Server in esecuzione sulla porta {PORT}")
    httpd.serve_forever()
